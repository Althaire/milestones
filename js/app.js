!function(a,b,c,d){"use strict";function e(b,c){var d,e=a.Deferred();try{d=JSON.parse(localStorage.getItem(b))}catch(f){}return d&&c?c?e.notify(d):e.resolve(d):c||e.reject(),c().done(function(a){try{localStorage.setItem(b,JSON.stringify(a))}catch(c){}}).done(function(a){e.resolve(a)}),e.promise()}function f(a,b){var c=[];a=a.reduce(function(a,b){return a[b.login]=b,a},{}),c=b.reduce(function(a,b){var c,d,e=b.milestone;return b.milestone?(c=a.map(function(a){return a.id}),d=c.indexOf(e.id),delete b.milestone,-1===d?(e.issues=[b],a.push(e)):(e=a[d],e.issues.push(b)),a):void 0},[]),b=b.map(function(a){return a.state=j(a),a.effort=k(a),a}),c=c.map(function(b){var c;return b.effort=b.issues.reduce(function(a,b){return a.total+=b.effort,a[b.state]+=b.effort,a},{total:0,closed:0,active:0,open:0}),b.state=b.open_issues>0?b.issues.reduce(function(a,b){return"closed"===a||"closed"===b.state?"active":"active"===a||"active"===b.state?"active":a},"open"):"closed",c=b.description.split(/\s+-{3,}\s+/),b.assignee=a[c[0].substr(7)],b.description=c[1],b.issues.sort(l),b}),c.sort(m),g(c),h(c)}function g(b){var d,e,f=0;b=b.map(function(a){return a.total=a.effort.total,a.closedPercent=parseInt(a.effort.closed/a.total*100,10),a.activePercent=parseInt(a.effort.active/a.total*100,10),a}),d=b.reduce(function(a,b){return a+b.total},0),e=b.map(function(a){return a.total=a.total/d*100,f+=a.total,c.template(p,c.extend({},a,{preceding:f-a.total}))}).join("\n"),a(".chart").html(e)}function h(b){var d=[];b.forEach(function(a){var b=a.issues.map(function(b,d,e){return c.template(o,c.extend(b,{isNewMilestone:0===d,numMilestoneIssues:e.length,milestoneTitle:a.title.replace(/^\d+\s+/,""),milestoneDescription:a.description,milestoneAssignee:a.assignee}))});d=d.concat(b)}),a("tbody").html(d.join("\n"))}function i(a){window.console.log(a)}function j(a){var b,c;return b=a.state,c=1===a.labels.filter(function(a){return"active"===a.name}).length,c&&(b="active"),b}function k(a){var b;return b=a.labels.reduce(function(a,b){var c=parseInt(b.name,10);return/^5+/.test(b.name)&&(c=7),"number"!=typeof c?a:c>a?c:a},0)}function l(a,b){return q[a.state]<q[b.state]?1:q[a.state]>q[b.state]?-1:a.update_at<b.update_at?1:a.update_at>b.update_at?-1:0}function m(a,b){return a.title>b.title?1:a.title<b.title?-1:0}function n(b){{var c=a(b.currentTarget);c.data("nr")}c.toggleClass("showDescription")}var o="";o+='<tr class="<%= isNewMilestone ? "newMilestone" : "" %>">\n',o+="    <% if (isNewMilestone) { %>\n",o+='    <th class="milestone" rowspan="<%= numMilestoneIssues %>">\n',o+='        <div class="pull-right">\n',o+='          <a href="<%= milestoneAssignee.html_url %>">\n',o+='              <img src="<%= milestoneAssignee.avatar_url %>s=24" alt="<%= milestoneAssignee.login %>">\n',o+="          </a>\n",o+="        </div>\n",o+="        <strong><%= milestoneTitle %></strong>\n",o+="        <small><%= markdown.toHTML(milestoneDescription) %></small>\n",o+="    </th>\n",o+="    <% } %>\n",o+='    <td class="task" data-nr="<%= number %>">\n',o+='        <div class="pull-right">\n',o+='          <a href="<%= assignee.html_url %>">\n',o+='              <img src="<%= assignee.avatar_url %>s=24" alt="<%= assignee.login %>">\n',o+="          </a>\n",o+='          <div title="<%= state %>" class="progress <%= effort > "5" ? "unratable" : "" %>" style="width: <%= effort * 2 %>0px">\n',o+='            <% if (state !== "open") { %>\n',o+='            <div class="progress-bar <%= state === "active" ? "progress-bar-striped active" : "" %>"  role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>\n',o+="            <% } %>\n",o+="          </div>\n",o+="        </div>\n",o+='        <strong><a href="<%= html_url %>">\n',o+="            <%= title %>\n",o+="        </a></strong>\n",o+="        <small><%= markdown.toHTML(body) %></small>\n",o+="    </td>\n",o+="</tr>";var p="";p+='<div class="progress-container" style="width: <%= total %>%; left: <%= preceding %>%;">',p+='  <div class="progress">',p+='    <div class="progress-bar" style="width: <%= closedPercent %>%"></div>',p+='    <div class="progress-bar progress-bar-striped active" style="width: <%= activePercent %>%"></div>',p+="  </div>",p+="</div>";var q={open:0,active:1,closed:2};a.when(e("owners",d.user("gr2m").repo("milestones").collaborators.findAll),e("issues",d.user("gr2m").repo("milestones").issues.findAll)).progress(f).done(f).fail(i),a(document.body).on("click","td.task",n)}(jQuery,initials,_,githubApi);